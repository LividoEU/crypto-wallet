@if (isLoggedIn()) { @if (isScanning()) {
<div class="loading-overlay">
  <mat-spinner diameter="48"></mat-spinner>
  <span class="loading-text">{{ 'dashboard.balance.scanning' | translate }}</span>
</div>
} @else {
<div class="dashboard-content">
  <div class="balance-section">
    <h2 class="balance-label">{{ 'dashboard.balance.title' | translate }}</h2>
    <div class="balance-display">
      <span class="balance-btc">{{ balanceBtc() | number : '1.8-8' }} BTC</span>
      @if (balanceEur() !== null) {
      <span class="balance-separator" aria-hidden="true"></span>
      <span class="balance-eur">{{ balanceEur() | number : '1.2-2' : 'es' }} EUR</span>
      }
    </div>
    <div class="balance-actions">
      <button
        mat-icon-button
        [matMenuTriggerFor]="receiveMenu"
        [matTooltip]="'dashboard.receive.tooltip' | translate"
        (menuOpened)="onReceiveMenuOpen()"
        class="receive-button"
        aria-label="Receive BTC"
      >
        <mat-icon>qr_code_2</mat-icon>
      </button>
      <mat-menu #receiveMenu="matMenu" class="receive-menu">
        <div class="receive-content" (click)="$event.stopPropagation()">
          @if (receiveAddress(); as address) {
          <qrcode
            [qrdata]="qrCodeData()"
            [width]="200"
            [errorCorrectionLevel]="'M'"
            [margin]="2"
            class="qr-code"
          ></qrcode>
          <div class="receive-address">
            <span class="address-text">{{ address.address }}</span>
            <button
              mat-icon-button
              (click)="copyAddress()"
              [matTooltip]="'dashboard.receive.copy' | translate"
              class="copy-button"
              aria-label="Copy address"
            >
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
          }
        </div>
      </mat-menu>
    </div>
  </div>

  <div class="transactions-section">
    <div class="section-header">
      <h2 class="section-title">{{ 'dashboard.transactions.title' | translate }}</h2>
      <button
        mat-icon-button
        (click)="refreshWallet()"
        [disabled]="isScanning()"
        [matTooltip]="'dashboard.transactions.refresh' | translate"
        class="refresh-button"
        aria-label="Refresh transactions"
      >
        <mat-icon [class.spinning]="isScanning()">refresh</mat-icon>
      </button>
    </div>

    @if (transactions().length === 0) {
    <div class="empty-state">
      <mat-icon class="empty-icon">receipt_long</mat-icon>
      <h3 class="empty-title">{{ 'dashboard.empty.noData' | translate }}</h3>
      <p class="empty-description">{{ 'dashboard.empty.noDataDescription' | translate }}</p>
    </div>
    } @else {
    <mat-accordion class="transactions-list">
      @for (tx of transactions(); track tx.hash) {
      <mat-expansion-panel class="transaction-panel">
        <mat-expansion-panel-header>
          <div class="tx-header">
            <div class="tx-col tx-col-status">
              <mat-icon [class]="getTransactionStatus(tx)" class="status-icon">
                {{ getStatusIcon(getTransactionStatus(tx)) }}
              </mat-icon>
            </div>
            <div class="tx-col tx-col-txid">
              <div class="tx-id-wrapper">
                <span class="tx-hash" [matTooltip]="tx.hash">{{ getTruncatedTxHash(tx.hash) }}</span>
                <button
                  mat-icon-button
                  class="copy-btn-small"
                  (click)="copyToClipboard(tx.hash, $event)"
                  [matTooltip]="'dashboard.receive.copy' | translate"
                  aria-label="Copy transaction ID"
                >
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
              <span class="tx-time">{{ formatDate(tx.time) | date : 'short' }}</span>
            </div>
            <div class="tx-col tx-col-addresses">
              <div class="tx-address-row">
                <span class="tx-address-label">{{ 'dashboard.transactions.from' | translate }}:</span>
                @if (getFromAddressSummary(tx); as fromSummary) {
                  @if (fromSummary.count > 1) {
                    <span class="tx-address-multi">{{ fromSummary.count }} {{ 'dashboard.transactions.inputs' | translate }}</span>
                  } @else {
                    <button
                      class="tx-address-link"
                      [class.own-address]="isOwnAddress(fromSummary.address)"
                      (click)="$event.stopPropagation(); navigateToAddress(fromSummary.address)"
                    >
                      {{ fromSummary.address }}
                    </button>
                    <button
                      mat-icon-button
                      class="copy-btn-small"
                      (click)="copyToClipboard(fromSummary.address, $event)"
                      [matTooltip]="'dashboard.receive.copy' | translate"
                      aria-label="Copy address"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  }
                }
              </div>
              <div class="tx-address-row">
                <span class="tx-address-label">{{ 'dashboard.transactions.to' | translate }}:</span>
                @if (getToAddressSummary(tx); as toSummary) {
                  @if (toSummary.count > 1) {
                    <span class="tx-address-multi">{{ toSummary.count }} {{ 'dashboard.transactions.outputs' | translate }}</span>
                  } @else {
                    <button
                      class="tx-address-link"
                      [class.own-address]="isOwnAddress(toSummary.address)"
                      (click)="$event.stopPropagation(); navigateToAddress(toSummary.address)"
                    >
                      {{ toSummary.address }}
                    </button>
                    <button
                      mat-icon-button
                      class="copy-btn-small"
                      (click)="copyToClipboard(toSummary.address, $event)"
                      [matTooltip]="'dashboard.receive.copy' | translate"
                      aria-label="Copy address"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  }
                }
              </div>
            </div>
            <div class="tx-col tx-col-amount">
              <span class="tx-amount" [class]="getTransactionStatus(tx)">
                {{ tx.result >= 0 ? '+' : '' }}{{ satoshisToBtc(tx.result) | number : '1.8-8' }} BTC
              </span>
              <span class="tx-fee-inline">
                {{ 'dashboard.transactions.fee' | translate }}:
                {{ satoshisToBtc(tx.fee) | number : '1.8-8' }} BTC @if (satoshisToEur(tx.fee); as
                feeEur) { ({{ feeEur | number : '1.2-2' : 'es' }} EUR) }
              </span>
            </div>
          </div>
        </mat-expansion-panel-header>

        <div class="tx-details">
          <div class="tx-details-grid">
            <div class="tx-section">
              <h4 class="tx-section-title">{{ 'dashboard.transactions.from' | translate }}</h4>
              <ul class="address-list">
                @for (input of tx.inputs; track $index) { @if (input.address) {
                <li>
                  <div class="address-with-copy">
                    <button
                      class="address-link"
                      [class.own-address]="isOwnAddress(input.address)"
                      (click)="navigateToAddress(input.address)"
                    >
                      {{ input.address }}
                    </button>
                    <button
                      mat-icon-button
                      class="copy-btn-small"
                      (click)="copyToClipboard(input.address)"
                      [matTooltip]="'dashboard.receive.copy' | translate"
                      aria-label="Copy address"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>
                  <div class="address-amounts">
                    <span class="address-value"
                      >{{ satoshisToBtc(input.value) | number : '1.8-8' }} BTC</span
                    >
                    @if (satoshisToEur(input.value); as eurValue) {
                    <span class="address-value-eur"
                      >{{ eurValue | number : '1.2-2' : 'es' }} EUR</span
                    >
                    }
                  </div>
                </li>
                } }
              </ul>
            </div>

            <div class="tx-section tx-section-to">
              <h4 class="tx-section-title">{{ 'dashboard.transactions.to' | translate }}</h4>
              <ul class="address-list">
                @for (output of tx.outputs; track $index) { @if (output.address) {
                <li>
                  <div class="address-with-copy">
                    <button
                      class="address-link"
                      [class.own-address]="isOwnAddress(output.address)"
                      (click)="navigateToAddress(output.address)"
                    >
                      {{ output.address }}
                    </button>
                    <button
                      mat-icon-button
                      class="copy-btn-small"
                      (click)="copyToClipboard(output.address)"
                      [matTooltip]="'dashboard.receive.copy' | translate"
                      aria-label="Copy address"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>
                  <div class="address-amounts">
                    <span class="address-value"
                      >{{ satoshisToBtc(output.value) | number : '1.8-8' }} BTC</span
                    >
                    @if (satoshisToEur(output.value); as eurValue) {
                    <span class="address-value-eur"
                      >{{ eurValue | number : '1.2-2' : 'es' }} EUR</span
                    >
                    }
                  </div>
                </li>
                } }
              </ul>
            </div>
          </div>
        </div>
      </mat-expansion-panel>
      }
    </mat-accordion>
    }
  </div>
</div>
} } @else {
<div class="empty-state full-height">
  <mat-icon class="empty-icon">account_balance_wallet</mat-icon>
  <h2 class="empty-title">{{ 'dashboard.empty.notLoggedIn' | translate }}</h2>
  <p class="empty-description">{{ 'dashboard.empty.notLoggedInDescription' | translate }}</p>
  <button mat-flat-button color="primary" (click)="openMnemonicDialog()" class="mnemonic-button">
    <mat-icon>vpn_key</mat-icon>
    {{ 'dashboard.empty.enterMnemonic' | translate }}
  </button>
</div>
}
